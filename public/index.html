<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <!-- Scramjet + Proxy -->
    <script src="/scram/scramjet.all.js"></script>
    <script src="baremux/index.js" defer></script>
    <script src="epoxy/index.js" defer></script>
    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    <script src="index.js" defer></script>


</head>
<link rel="stylesheet" type="text/css" href="index.css">

<body>
    <div id="topbar">
        <div class="logo">DoxyEdu</div>
        <nav>
            <a href="#learning-news">News</a>
            <a href="#sj-form">Search</a>
            <a href="https://github.com/Arandomdude222/DoxyEdu-web-proxy" target="_blank">Github</a>
            <a href="/credits.html">Credits</a>
        </nav>
    </div>

    <!-- MAIN CONTENT -->
    <main>
        <div class="server-info">
            DoxyEdu Repo at <b>https://github.com/Arandomdude222/DoxyEdu-web-proxy</b>
        </div>

        <div class="logo-section">
            <img src="logo.svg" alt="DoxyEdu Logo">
            <!-- <p>DoxyEdu is the spot where you can get quick, clear help with any topic you're stuck on.</p> -->
        </div>



        <!-- SEARCH FORM -->
        <form id="sj-form" class="flex-center">
            <input id="sj-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
            <input id="sj-address" type="text" placeholder="Enter any URL or search the web..." />
            <button type="submit">Go</button>
        </form>

        <!-- NEWS SECTION -->
        <div class="news-section">
            <h2>LearnNews</h2>
            <div id="learning-news"></div>
        </div>

        <div id="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Loading topic</p>
                <div class="loading-progress">
                    <div class="progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- not needed -->
        <!-- <iframe id="sj-frame" style="display: none;" loading="lazy"></iframe> -->

        <script>
            document.getElementById('sj-form').addEventListener('submit', function () {
                const loading = document.getElementById('loading-overlay');
                loading.style.display = 'flex';
                loading.style.animation = 'fadeOut 3s forwards';
                loading.style.animationDelay = '2s';
            });
        </script>

        <!-- ERROR DISPLAY -->
        <div style="width: 100%; max-width: 800px; margin: 20px auto;">
            <p id="sj-error" style="color: #ff6b6b; text-align: center;"></p>
            <pre id="sj-error-code"
                style="background: #1a1a1a; padding: 15px; border-radius: 8px; overflow: auto; color: #ccc; font-size: 0.9rem;"></pre>
        </div>
    </main>

    <!-- BOTTOM NAV -->
    <div id="bottom-nav">
        <a href="/">Home</a>
        <a href="#learning-news">News</a>
        <a href="#sj-form">Search</a>
        <a href="#" target="_blank">Live Desktop</a>
        <a href="/credits.html">Credits</a>
    </div>

    <!-- FOOTER -->
    <footer>
        <span>DoxyEdu &copy;| MW 2025</span>
    </footer>

    <!-- CHAT WIDGET (used to be chat widget but cant be bothered to rename) -->
    <div id="chat-container">
        <div id="chat-header">
            <span>Update Logs</span>
            <div>
                <button id="chat-toggle">-</button>
                <button id="chat-close">x</button>
            </div>
        </div>
        <iframe id="update-logs" src="/assets/2.html"></iframe>
    </div>

    <script>
        // Chat Widget Functionality
        const chatContainer = document.getElementById("chat-container");
        const chatHeader = document.getElementById("chat-header");
        let offsetX, offsetY;

        chatHeader.onmousedown = (e) => {
            offsetX = e.clientX - chatContainer.offsetLeft;
            offsetY = e.clientY - chatContainer.offsetTop;
            chatContainer.style.cursor = "grabbing";
            document.onmousemove = drag;
            document.onmouseup = stopDrag;
        };

        function drag(e) {
            chatContainer.style.left = (e.clientX - offsetX) + "px";
            chatContainer.style.top = (e.clientY - offsetY) + "px";
        }

        function stopDrag() {
            document.onmousemove = null;
            chatContainer.style.cursor = "default";
        }

        document.getElementById("chat-close").onclick = () => {
            chatContainer.style.display = "none";
        };

        const chatIframe = document.getElementById("update-logs");
        let collapsed = false;
        document.getElementById("chat-toggle").onclick = () => {
            if (!collapsed) {
                chatIframe.style.display = "none";
                chatContainer.style.height = "40px";
                collapsed = true;
            } else {
                chatIframe.style.display = "block";
                chatContainer.style.height = "600px";
                collapsed = false;
            }
        };

        // RSS Feed Loader
        const RSS_URL = "https://learningnews.com/feed";

        async function loadRSS(url) {
            try {
                const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);
                const data = await res.json();
                const newsContainer = document.getElementById("learning-news");

                if (!data.items || !newsContainer) return;

                newsContainer.innerHTML = "";

                data.items.slice(0, 6).forEach((item, i) => {
                    const card = document.createElement("div");
                    card.className = "news-card";
                    if (i < 2) card.classList.add("big");

                    const a = document.createElement("a");
                    a.href = item.link;
                    a.target = "_blank";
                    a.textContent = item.title;

                    const source = document.createElement("div");
                    source.style.color = "#888";
                    source.style.fontSize = "0.9rem";
                    source.style.marginTop = "8px";
                    source.textContent = item.pubDate ?
                        new Date(item.pubDate).toLocaleDateString() + " â€¢ " + (item.source || "News") :
                        (item.source || "News");

                    card.appendChild(a);
                    card.appendChild(source);
                    newsContainer.appendChild(card);
                });
            } catch (err) {
                console.error("Failed to load RSS:", err);
                const newsContainer = document.getElementById("learning-news");
                if (newsContainer) {
                    newsContainer.innerHTML = `
                        <div class="news-card big" style="text-align: center; padding: 40px;">
                            <p style="color: #888;">Latest educational news will appear here</p>
                        </div>
                    `;
                }
            }
        }
        document.addEventListener("DOMContentLoaded", () => {
            loadRSS(RSS_URL);

            const searchForm = document.getElementById('sj-form');
            const searchInput = document.getElementById('sj-address');

            // Handle Enter key
            searchInput.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (searchInput.value.trim()) {
                        setTimeout(() => {
                            searchForm.dispatchEvent(new Event('submit', {
                                bubbles: true,
                                cancelable: true
                            }));
                        }, 10);
                    }
                }
            });

            // Ensure form doesn't do default submission
            searchForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Show iframe
                const iframe = document.getElementById('sj-frame');
                if (iframe) {
                    iframe.style.display = 'block';
                    iframe.style.backgroundColor = '#000';
                }

                return false;
            });

            // Auto-scroll to iframe when it's created
            const frameObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.addedNodes) {
                        mutation.addedNodes.forEach((node) => {
                            if (node.tagName === 'IFRAME' && node.id === 'sj-frame') {
                                setTimeout(() => {
                                    node.scrollIntoView({
                                        behavior: 'smooth',
                                        block: 'start'
                                    });
                                }, 300);
                            }
                        });
                    }
                });
            });

            frameObserver.observe(document.body, {
                childList: true,
                subtree: true
            });

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;

                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>

</html>