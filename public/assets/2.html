<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Update Logs</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(to right, #243B55, #141E30);
    color: #fff;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 40px;
  }

  .version {
    margin-bottom: 40px;
  }

  .version h2 {
    color: #00c3ff;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    padding-bottom: 6px;
    margin-bottom: 14px;
  }

  .log {
    background: rgba(255,255,255,0.06);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
  }

  .meta {
    font-size: 0.85rem;
    opacity: 0.7;
    margin-bottom: 6px;
  }

  ul {
    padding-left: 18px;
    margin: 0;
  }
</style>
</head>

<body>
<div class="container">
  <h1>Update Logs</h1>
  <div id="logs"></div>
</div>

<script>
  const OWNER = "Arandomdude222";
  const REPO = "DoxyEdu-web-proxy";
  const LIMIT = 40;

  const logsContainer = document.getElementById("logs");

  function extractVersion(message) {
    const match = message.match(/v?\d+\.\d+\.\d+/i);
    return match
      ? (match[0].startsWith("v") ? match[0] : "v" + match[0])
      : null;
  }

  fetch(`https://api.github.com/repos/${OWNER}/${REPO}/commits`)
    .then(res => res.json())
    .then(commits => {
      const grouped = {};

      let preVersionPatch = 1;
      let postVersionPatch = 1;
      let projectStarted = false;

      commits.slice(0, LIMIT).reverse().forEach(c => {
        let version = extractVersion(c.commit.message);

        if (version) {
          projectStarted = true;
          postVersionPatch = parseInt(version.split(".")[2]) + 1;
        } else {
          if (!projectStarted) {
            version = `v0.0.${preVersionPatch++}`;
          } else {
            version = `v1.0.${postVersionPatch++}`;
          }
        }

        if (!grouped[version]) grouped[version] = [];
        grouped[version].push(c);
      });

      // render newest first
      Object.keys(grouped)
        .reverse()
        .forEach(version => {
          const section = document.createElement("div");
          section.className = "version";
          section.innerHTML = `<h2>${version}</h2>`;

          grouped[version].forEach(c => {
            const date = new Date(c.commit.author.date).toLocaleDateString("en-GB");
            const msg = c.commit.message.split("\n")[0];

            const div = document.createElement("div");
            div.className = "log";
            div.innerHTML = `
              <div class="meta">${date}</div>
              <ul><li>${msg}</li></ul>
            `;
            section.appendChild(div);
          });

          logsContainer.appendChild(section);
        });
    })
    .catch(() => {
      logsContainer.innerHTML = "<p>Failed to load logs</p>";
    });
</script>
</body>
</html>
